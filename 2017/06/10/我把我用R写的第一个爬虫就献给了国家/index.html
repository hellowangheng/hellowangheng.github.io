<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="Just do what I want."><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>我把我用R写的第一个爬虫就献给了国家 - 王亨的博客</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li><li><a href="http://blog.csdn.net/wzgl__wh"><span>CSDN</span></a></li><li><a href="http://www.cnblogs.com/wheng/"><span>博客园</span></a></li><li><a href="/about"><span>关于</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="/images/background/backtwo.jpg"><div class="post-title"><h1 class="title">我把我用R写的第一个爬虫就献给了国家</h1><ul class="meta"><li><i class="icon icon-author"></i>王亨</li><li><i class="icon icon-clock"></i>5 Minutes</li><li><i class="icon icon-calendar"></i>June 10, 2017</li></ul></div></div><div class="article-content" style="max-width:800px"><p>　　作为我国社会主义事业的建设者和接班人，不仅要继承前辈开创的伟大事业，更要推进中国特色社会主义的航船继续破浪前进。<br>　　这不，为了响应习大大开展的“两学一做”学习教育，我不仅认真学习共产党党章党规，学习贯彻习近平总书记系列重要讲话精神，争做一名合格党员。今天我就要用自己的技术来学习今年的<a href="http://www.gov.cn/premier/2017-03/16/content_5177940.htm" target="_blank" rel="external">《政府工作报告》</a>。<br>   今天我们要用爬虫来爬取这篇文章，然后进行文本分词，再到文本可视化。我们需要使用下面这三个包：<br>（1）rvest 爬虫<br>（2）jiebaR 用于分词，统计词频<br>（3）wordcloud2 用于对文本进行可视化</p>
<h3 id="1-使用rvest包爬取文章。"><a href="#1-使用rvest包爬取文章。" class="headerlink" title="1.使用rvest包爬取文章。"></a>1.使用rvest包爬取文章。</h3><p>　　首先，我需要对网页标签进行查看分析，下面这张图就是我用谷歌浏览器，对网页标签进行分析的过程。</p>
<p><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/analyze.gif" ,alt="analyze" ,="" width="700" height="400"></p>
<p><center></center><br>不知道大家有没有注意到下面这个表签。我们需要爬取的文字就在这个标签里面。<br><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/class.png" alt=""><br>现在我们就开始写爬取代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">library(rvest)  </div><div class="line">url&lt;-&apos;http://www.gov.cn/premier/2017-03/16/content_5177940.htm&apos;  </div><div class="line">web&lt;-read_html(url,encoding=&quot;utf-8&quot;) #读取数据，规定编码  </div><div class="line">position&lt;-web %&gt;% html_nodes(&quot;div.pages_content&quot;) %&gt;% html_text()</div></pre></td></tr></table></figure></p>
<p>%&gt;%管道函数，将左边的值赋给右边函数作为第一个参数的值。<br>web存储网页信息的变量。<br>然后html_nodes()函数获取网页里的相应节点。<br>最后我们用html_text()函数获取标签内的文本信息。</p>
<h3 id="2-使用jiebaR进行分词，统计词频"><a href="#2-使用jiebaR进行分词，统计词频" class="headerlink" title="2.使用jiebaR进行分词，统计词频"></a>2.使用jiebaR进行分词，统计词频</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">library(jiebaR)  </div><div class="line">engine_s&lt;-worker(stop_word = &quot;stopwords.txt&quot;)#初始化分词引擎并加载停用词。  </div><div class="line">seg&lt;-segment(position,engine_s)#分词  </div><div class="line">f&lt;-freq(seg) #统计词频  </div><div class="line">f&lt;-f[order(f[2],decreasing=TRUE),] #根据词频降序排列</div></pre></td></tr></table></figure>
<p><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/segment.png" alt=""><br>这是排序之后前6个。</p>
<h3 id="3-使用wordcloud2包进行可视化。"><a href="#3-使用wordcloud2包进行可视化。" class="headerlink" title="3.使用wordcloud2包进行可视化。"></a>3.使用wordcloud2包进行可视化。</h3><p>使用jiebaR包统计完词频之后，就很容易使用wordcloud2包进行可视化。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(wordcloud2)#加载包  </div><div class="line">f2&lt;-f2[1:150,]     #总共有2000多个词，为了显示效果，我只提取前150个字  </div><div class="line">wordcloud2(f2, size = 0.8 ,shape=&apos;star&apos;)    #形状设置为一颗五角星</div></pre></td></tr></table></figure></p>
<p><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/star.png" alt=""><br>　　作为一名爱国爱党人事，我们都知道我们的国旗是五星红旗，所以就用这颗星来代表我的爱国之心吧。那也许就有人要说，你也体现以下你的爱党之心吧。行，没问题，接下来我就来体现一下我的爱党之心。我要把这个五角星形状改成一张党徽形状。只怪自己PS技术太差，所以在网上找了下面这张图，找这张图的目的是要将绘制词云图形设置为一个党徽。</p>
<p><center><br><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/back-danghui.png" alt=""><br></center><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">path&lt;-&quot;D://dang.png&quot;#图片路径  </div><div class="line">wordcloud2(f2,size = 1.3,figPath =path)#绘图，如果形状和图片形状不太像是，可以调节size值</div></pre></td></tr></table></figure></p>
<p><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/word-danghui.png" alt=""><br>　　怎么样，是不是和党徽形状基本一样。不过细心的小伙伴估计会发现“发展”这个词没了，它可是词频最高的一个词啊。我认为原因是我们这个党徽图片中各个边太细，“发展”这个词的词频有太高于其他词频才导致这张词云里面没有“发展”这个词。“发展”的词频是125，差不多是“改革”的词频是68的两倍.为了验证这个想法，我决定选一个边更细的形状。<br><code><br>letterCloud(f2, word=”党”,size = 1)  #Word参数用于设置绘制词云形状为“党”这个字。<br></code><br><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/dang.png" alt=""><br>  刚才还有的“改革”，“推进”，“经济”等词现在也没有了。所以证明我的说法基本没错。于是我就P了下面这一张图。把词绘制在图片黑色的地方，白色党徽的地方留下。 </p>
<p><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/back-dangqi.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">path3&lt;-&quot;D://3.png&quot;</div><div class="line">f3&lt;-f[1:1000,]  #因为图片面积比较大，所以这次选前1000个词 </div><div class="line">wordcloud2(f3,size = 1.7,figPath =path3,background=&apos;black&apos;) #background用于设置背景颜色，为了便于观察我设置为黑色</div></pre></td></tr></table></figure></p>
<p><img src="/2017/06/10/我把我用R写的第一个爬虫就献给了国家/word-dangqi.png" alt=""></p>
<p>　　这下好了，刚才丢失的词现在已经回来了，就是不知道中间那块黑色党徽那块你注意到没有。所以在这个给各位小伙伴提个醒，在用这个包绘制词云时，背景图片不要选择那些整体边太细的图，否则会影响结果。</p>
<h3 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h3><p>　　现在，我来总结一下，大家都知道我们党执政兴国的第一要务是——发展。与我们分析的一致。在过去的一年，我们党仍然以发展作为第一要务，推进“一路一带”建设，加快创新发展，大力深化改革开放，明确政府职能，不断完善社会体制，不断提高服务能力，注重保障和改善民生，增加就业机会，实现经济的稳定增长。推动各族人民在全面建成小康社会进程中实现共同发展繁荣。</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/R语言/">R语言</a><span class="tag-list-count">2</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/爬虫/">爬虫</a><span class="category-list-count">1</span></li></ul></div></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="cj3vcgyq2000atoug5bp0auq0" data-title="我把我用R写的第一个爬虫就献给了国家" data-url="http://yoursite.com/2017/06/10/我把我用R写的第一个爬虫就献给了国家/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2017/06/10/markdown学习笔记/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2017/06/10/first-hexo-essay/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/hellowangheng" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="http://weibo.com/5390036467/profile?topnav=1&amp;wvr=6&amp;is_all=1" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="hello.wangheng@qq.com" title="Email" target="_blank"><i class="icon icon-email"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2017 王亨的博客<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>